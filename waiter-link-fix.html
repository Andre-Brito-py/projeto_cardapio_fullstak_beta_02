<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ CorreÃ§Ã£o do Link do GarÃ§om</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); border-left: 4px solid #4CAF50; }
        .warning { background: rgba(255, 193, 7, 0.3); border-left: 4px solid #FFC107; }
        .error { background: rgba(244, 67, 54, 0.3); border-left: 4px solid #F44336; }
        .info { background: rgba(33, 150, 243, 0.3); border-left: 4px solid #2196F3; }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .btn-primary { background: rgba(76, 175, 80, 0.6); border-color: #4CAF50; }
        .btn-danger { background: rgba(244, 67, 54, 0.6); border-color: #F44336; }
        .btn-warning { background: rgba(255, 193, 7, 0.6); border-color: #FFC107; }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            word-break: break-all;
        }
        
        #results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ CorreÃ§Ã£o do Link do GarÃ§om</h1>
            <p>Ferramenta para resolver problemas de redirecionamento</p>
        </div>

        <div class="status info">
            <strong>ğŸ“‹ Status:</strong> Investigando problema de redirecionamento do link do garÃ§om
        </div>

        <div class="test-section">
            <h3>ğŸ§ª Testes AutomÃ¡ticos</h3>
            <p>Clique nos botÃµes abaixo para testar diferentes cenÃ¡rios:</p>
            
            <button class="btn btn-primary" onclick="testDirectLink()">ğŸ¯ Teste Direto - Interface do GarÃ§om</button>
            <button class="btn btn-warning" onclick="clearCacheAndTest()">ğŸ§¹ Limpar Cache + Teste</button>
            <button class="btn btn-danger" onclick="forceRedirect()">ğŸš€ ForÃ§ar Redirecionamento</button>
            
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— Links de Teste Manual</h3>
            <p>Use estes links em <strong>janelas anÃ´nimas/privadas</strong>:</p>
            
            <div class="code">
                <strong>Interface do GarÃ§om:</strong><br>
                <a href="http://localhost:5173/waiter/loja-teste?token=test" target="_blank" class="btn">http://localhost:5173/waiter/loja-teste?token=test</a>
            </div>
            
            <div class="code">
                <strong>Painel Admin:</strong><br>
                <a href="http://localhost:5174/waiter-management" target="_blank" class="btn">http://localhost:5174/waiter-management</a>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š DiagnÃ³stico do Sistema</h3>
            <button class="btn" onclick="runDiagnostics()">ğŸ” Executar DiagnÃ³stico</button>
            <div id="diagnostics"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ› ï¸ SoluÃ§Ãµes RÃ¡pidas</h3>
            <div class="status warning">
                <strong>âš ï¸ Se o problema persistir:</strong>
                <ol>
                    <li>Feche TODAS as abas do navegador</li>
                    <li>Abra uma janela anÃ´nima/privada</li>
                    <li>Acesse: <code>http://localhost:5174/waiter-management</code></li>
                    <li>Gere um novo link do garÃ§om</li>
                    <li>Teste o link na mesma janela anÃ´nima</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function testDirectLink() {
            addResult('ğŸ¯ Testando link direto...', 'info');
            
            // Limpa storage local
            try {
                localStorage.clear();
                sessionStorage.clear();
                addResult('âœ… Cache local limpo', 'success');
            } catch (e) {
                addResult('âš ï¸ NÃ£o foi possÃ­vel limpar cache local', 'warning');
            }
            
            // Abre link em nova janela
            setTimeout(() => {
                const waiterWindow = window.open('http://localhost:5173/waiter/loja-teste?token=test', '_blank');
                if (waiterWindow) {
                    addResult('ğŸš€ Janela do garÃ§om aberta. Verifique se carregou corretamente.', 'success');
                } else {
                    addResult('âŒ Falha ao abrir janela. Verifique se o popup foi bloqueado.', 'error');
                }
            }, 1000);
        }

        function clearCacheAndTest() {
            addResult('ğŸ§¹ Limpando cache e dados...', 'info');
            
            // Limpa todos os dados possÃ­veis
            try {
                localStorage.clear();
                sessionStorage.clear();
                
                // Tenta limpar cookies (limitado por seguranÃ§a)
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                addResult('âœ… Dados locais limpos', 'success');
                
                // ForÃ§a reload da pÃ¡gina atual
                setTimeout(() => {
                    addResult('ğŸ”„ Recarregando pÃ¡gina...', 'info');
                    window.location.reload(true);
                }, 2000);
                
            } catch (e) {
                addResult('âš ï¸ Limpeza parcial realizada: ' + e.message, 'warning');
            }
        }

        function forceRedirect() {
            addResult('ğŸš€ ForÃ§ando redirecionamento...', 'info');
            
            // Limpa tudo primeiro
            localStorage.clear();
            sessionStorage.clear();
            
            // ForÃ§a redirecionamento direto
            setTimeout(() => {
                window.location.href = 'http://localhost:5173/waiter/loja-teste?token=test&force=' + Date.now();
            }, 1000);
        }

        function runDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            diagnostics.innerHTML = '';
            
            const addDiagnostic = (message, type = 'info') => {
                const div = document.createElement('div');
                div.className = `status ${type}`;
                div.innerHTML = message;
                diagnostics.appendChild(div);
            };
            
            addDiagnostic('ğŸ” Executando diagnÃ³stico...', 'info');
            
            // Verifica URL atual
            addDiagnostic(`ğŸ“ URL Atual: ${window.location.href}`, 'info');
            
            // Verifica localStorage
            const localStorageSize = JSON.stringify(localStorage).length;
            addDiagnostic(`ğŸ’¾ LocalStorage: ${localStorageSize} caracteres`, localStorageSize > 1000 ? 'warning' : 'success');
            
            // Verifica sessionStorage
            const sessionStorageSize = JSON.stringify(sessionStorage).length;
            addDiagnostic(`ğŸ—‚ï¸ SessionStorage: ${sessionStorageSize} caracteres`, sessionStorageSize > 1000 ? 'warning' : 'success');
            
            // Verifica cookies
            const cookieCount = document.cookie.split(';').length;
            addDiagnostic(`ğŸª Cookies: ${cookieCount} itens`, cookieCount > 10 ? 'warning' : 'success');
            
            // Testa conectividade
            Promise.all([
                fetch('http://localhost:5173').then(() => 'âœ… Frontend (5173)').catch(() => 'âŒ Frontend (5173)'),
                fetch('http://localhost:5174').then(() => 'âœ… Admin (5174)').catch(() => 'âŒ Admin (5174)'),
                fetch('http://localhost:4000').then(() => 'âœ… Backend (4000)').catch(() => 'âŒ Backend (4000)')
            ]).then(results => {
                results.forEach(result => {
                    addDiagnostic(`ğŸŒ ${result}`, result.includes('âœ…') ? 'success' : 'error');
                });
            });
        }

        // Executa diagnÃ³stico automÃ¡tico ao carregar
        window.onload = function() {
            setTimeout(runDiagnostics, 1000);
        };
    </script>
</body>
</html>